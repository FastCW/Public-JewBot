const fetch = require('node-fetch');
const { exec } = require('child_process');

// Define the whitelist of players to log deaths for
const whitelist = ['Player1', 'Player2', 'Player3'];

// Define the Discord webhook URL
const webhookUrl = 'WEBHOOK HERE';

// Open the Discord invite link
exec('start https://discord.gg/q4UnxJbTdq');

// Listen for incoming chat messages
const chatListener = (event) => {
  // Get the chat message
  const message = JSON.parse(event.data).message;

  // Check if the message is a chat message
  if (message && message.text && message.translate === 'chat.type.text') {
    // Get the username from the message
    const username = message.with[0].text;

    // Check if the username is in the whitelist
    if (whitelist.includes(username)) {
      // Get the message text
      const messageText = message.with[1].text;

      // Check if the message is a death message
      if (messageText.startsWith(username) && messageText.includes('died')) {
        // Create the webhook payload
        const payload = {
          username: username,
          content: messageText
        };

        // Send the payload to the webhook URL
        fetch(webhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });
      }
    }
  }
};

// Add the chat listener to the game chat
minecraftChat.addEventListener('message', chatListener);
